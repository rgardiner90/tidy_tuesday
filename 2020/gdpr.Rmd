---
title: "gdpr"
author: "Richard G. Gardiner"
date: "4/21/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(lubridate)

gdpr_violations <- readr::read_tsv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-04-21/gdpr_violations.tsv')
gdpr_text <- readr::read_tsv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-04-21/gdpr_text.tsv')
```

```{r}
gdpr_violations
```

## Plan for Analysis

```{r}
gdpr_violations %>%
  separate_rows(article_violated, sep = "\\|") %>%
  count(article_violated, sort = TRUE) %>%
  mutate(article_violated = fct_reorder(article_violated, n)) %>%
  head(10) %>%
  ggplot(aes(x = article_violated, y = n)) +
  geom_col() +
  labs(x = "Article Violated", y = "Number of Times Citated") +
  coord_flip() +
  theme_minimal() 
```

```{r}
gdpr_violations %>%
  count(name, sort = TRUE)
```

```{r}
gdpr_violations %>%
  group_by(name) %>%
  summarise(sum_price = sum(price, na.rm = TRUE)) %>%
  ungroup() %>%
  arrange(desc(sum_price)) %>%
  head(15) %>%
  mutate(name = fct_reorder(name, sum_price)) %>%
  ggplot(aes(x = name, y = sum_price)) +
  geom_col() +
  labs(x = "Country Name", y = "Total Fines",
       title = "Total Fines by Country Name") +
  scale_y_continuous(labels = scales::dollar_format()) +
  coord_flip()
```


STILL NEED TO WORK ON THIS
```{r}
gdpr_violations %>%
  mutate(date2 = parse_date(date, "%m/%d/%Y")) %>%
  count(date2) %>%
  filter(date2 > "1970-01-01") %>%
  mutate(month = month(date2),
         year = year(date2)) %>%
  group_by(month, year) %>%
  summarise(total = sum(n)) %>%
  ungroup() %>%
  mutate(month_year = as.Date(paste0(year, "-", month, "-01"))) %>%
  ggplot(aes(x = month, y = total, color = factor(year))) +
  geom_line()

gdpr_violations %>%
  mutate(date2 = parse_date(date, "%m/%d/%Y")) %>%
  count(date2) %>%
  filter(date2 > "1970-01-01") %>%
  mutate(month = month(date2),
         year = year(date2)) %>%
  group_by(month, year) %>%
  summarise(total = sum(n)) %>%
  ungroup() %>%
  mutate(month_year = as.Date(paste0(year, "-", month, "-01"))) %>%
  ggplot(aes(x = month_year, y = total)) +
  geom_line() +
  theme_minimal() +
  labs(x = "", y = "Number of Fines Issued",
       title = "Number of Fines Issued by Month")
```

```{r}
gdpr_violations %>%
  mutate(date2 = parse_date(date, "%m/%d/%Y")) %>%
  filter(date2 > "1970-01-01") %>%
  mutate(year = year(date2)) %>%
  group_by(year) %>%
  summarise(total = sum(price)) %>%
  ungroup()  %>%
  ggplot(aes(x = year, y = total)) +
  geom_col() +
  scale_y_continuous(labels = scales::dollar_format()) +
  labs(x = "Year",
       y = "Total Fines (in Euros)",
       title = "Total Number of Fines for Each Year",
       subtitle = "GDPR took effect May 28, 2018. Data reported through April 2020.") +
  theme_minimal()
```


3. Look at the largest fines to see if it is much different. Do a histogram of all fines.
4. Regression of country and authority on amount.
5. do tf-idf or something to by article to figure out what each one is about (gdpr_text)
